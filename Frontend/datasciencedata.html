<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Learners</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=auto_transmission" />
  <style>

body {
      font-size: 14px;
      font-family: "Verdana", Sans-serif;
      font-weight: 200;
      line-height: 2.3em;
      margin: 0;
      overflow-x: hidden; /* prevent horizontal scroll */
      padding-top: 70px; /* for fixed navbar */
    }

.btn-outline-primary {
    --bs-btn-color: #ffb32b;
    --bs-btn-border-color: #ffb32b;
    --bs-btn-hover-color: #fff;
    --bs-btn-hover-bg: #ffb32b;
    --bs-btn-hover-border-color: #ffb32b;
    --bs-btn-focus-shadow-rgb: 13, 110, 253;
    --bs-btn-active-color: #fff;
    --bs-btn-active-bg: #ffb32b;
    --bs-btn-active-border-color: #ffb32b;
    }

    /* Navbar */
    .navbar-brand img {
      height: 50px;
      padding-left: 30px;
    }
    .navbar .container-fluid {
      justify-content: space-between !important;
    }

    /* Sidebar */
    #sidebar {
      width: 280px;
      height: 100vh;
      position: fixed;
      top: 70px;
      left: 0;
      background-color: #f8f9fa;
      overflow-y: auto;
      z-index: 1020;
      transform: translateX(-100%); /* hidden by default */
      transition: transform 0.3s ease-in-out;
    }

    #sidebar.visible {
      transform: translateX(0);
    }

    .list-group-item {
      color: #59585B;
      font-weight: 500;
      font-size: 17px;
      padding: 8.2px 20px;
      line-height: 45px;
    }
    
.logo{
    width: 200px;
    line-height: 200px;
    margin: 0 10px;
}


h1{
     
    font-weight: bold;
    color:#59585B;
    font-size: 40px;
    text-align: center;
    font-family: "verdana", Sans-serif;
    margin-bottom:25px ;
}

.h-light{
  font-weight: 400;

}

.label{
color: #b3b1b8;
}

.search-button{
  color: black;
      font-size: 15px;
      width: 220px;
      line-height: 1.7;
      border: 1px solid #F4F4F4;
      border-radius: 6px;
      padding: 10px;
      text-align: center;
      margin-left: 5px;
      transition: all 0.2s ease-in-out;
    }

    .search-button:hover{
      border: 2px solid #FF7600
    }


.input{
    width: 100%;
    line-height: 5em;
   font-size: 14px;
     font-family: "verdana", Sans-serif;
    font-weight: 200;
    
}


.button {
    background-color: #FF7600;
    color: #F4F4F4;
    padding: 10px;
    width: 30%;
    box-shadow: none;
    border-radius: 3px;
    border: none;
    margin-top: 20px;
    font-weight: bold;
    font-size: 14px;
    transition: all 200ms ease-in-out;
    cursor: pointer;
    
    display: block;
    margin-left: auto;
    margin-right: auto;
}


.button:hover{
    background-color: #ffffff;
    color: #ff7600;
    border: 2px solid #FF7600;
}
h2{
    color: #ff7600;
}

th, td{
  white-space: nowrap;
}

/* Status Grid */
.status-container {
      background-color: white;
      padding: 10px 0;
      border-radius: 12px;
      max-width: 100%;
      margin:0 auto ;
    }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
    }

    .status-item {
      background-color: rgb(255, 179, 43);
      color: white;
      text-align: center;
      padding: 0.7rem 0;
      border-radius: 8px;
      font-weight: 500;
      line-height: 3;
      font-size: 20px;
      transition: background-color 0.2s ease-in-out;
    }
    .item1{
      background-color: rgb(89, 177, 97)
    }

    .item2{
      background-color: rgb(217, 0, 52)
    }
    .item1:hover{background-color: rgb(89, 177, 97);}
    .item2:hover { background-color: rgb(217, 0, 52); color: white; }
    .item3:hover { background-color: #ff6700; }
 footer{
        margin-top: 50px;
        color: hsl(179, 100%, 32%);
        text-align: center;
      }
    .content {
      margin: 20px 0;
      transition: margin 0.3s ease-in-out;
      padding: 15px;
    
    }

    .content.shifted {
      margin-left: 220px;
    }

  .bulk{
    display: flex;
    justify-content: space-between;
    margin: 30px 0;
  }

   .upload{
        border: 2px solid hsl(179, 100%, 32%);
        background-color: white;
        color: hsl(179, 100%, 32%);
        transition: transform 0.2s ease-in-out;
        font-weight: 600;
        width: 180px;
        border-radius: 3px;
        }

        .upload:hover{
        background-color: hsl(179, 100%, 32%);
        color: #ffffff;
        border: none;
        }

      .selected-learners{
      font-size: 17px;
      line-height: 1.7;
      margin: 0px;
      font-weight: 600;
      color: hsl(179, 100%, 32%);
    }

    .filter{
      transition: transform 0.2s ease-in-out;
    }

    .filter:hover{
      border: 2px solid #FF7600
    }

    td, .svg-update:hover{
      color:#ffb32b
    }
    .status-yes {
      color: #008000; /* Green */
    }

    .status-no {
      color: #d10000; /* Red */
    }


.verified { color: green; font-weight: bold; }
  .mismatch { color: red; font-weight: bold; }
  .pending { color: orange; font-weight: bold; }
  .ocr-cell { 
    white-space: normal; 
    word-break: break-word; 
    line-height: 1.4; 
    max-width: 300px; 
  }
  </style>
</head>
<body>

  
<nav class="navbar bg-body-tertiary fixed-top">
  <div class="container-fluid d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center">
      <button class="btn btn-outline-primary" id="sidebarToggle">â˜°</button>
      <a class="navbar-brand mb-0 h1 p-0 ms-3" href="#">
        <img src="https://academylms.mindworx.co.za/pluginfile.php/1/theme_moove/logo/1750410985/Mindworx%20Academy%20logo%20%281%29%20%281%29.png" alt="Logo">
      </a>
    </div>
    <div class="search-filter">
      <input type="text" id="searchInput" class="search-button" placeholder="Search">
      <select id="statusFilter" class="search-button filter">
        <option class="filter-item" value="all">All</option>
        <option class="filter-item"  value="uploaded">Uploaded</option>
        <option class="filter-item"  value="not_uploaded">Not Uploaded</option>
      </select>
    </div>
  </div>
</nav>

<div class="d-flex">
  <!-- Sidebar -->
      <div id="sidebar" class="bg-light border-end">
        <div class="list-group list-group-flush">
          <a href="{{ url_for('admin_home') }}" class="list-group-item list-group-item-action">
            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px" fill="currentColor">
              <path d="M240-200h120v-240h240v240h120v-360L480-740 240-560v360Zm-80 80v-480l320-240 320 240v480H520v-240h-80v240H160Zm320-350Z"/>
            </svg>
            Home
          </a>
          <a href="{{ url_for('view_learn') }}" class="list-group-item list-group-item-action">
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30px" fill="currentColor" class="bi bi-people-fill" viewBox="0 0 16 16">
              <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6m-5.784 6A2.24 2.24 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.3 6.3 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1zM4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5"/>
            </svg>
            All Learners
          </a>
          <a href="{{ url_for('business_analysis')}}" class="list-group-item list-group-item-action">
            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px" fill="currentColor">
              <path d="M400-320q100 0 170-70t70-170q0-100-70-170t-170-70q-100 0-170 70t-70 170q0 100 70 170t170 70Zm-40-120v-280h80v280h-80Zm-140 0v-200h80v200h-80Zm280 0v-160h80v160h-80ZM824-80 597-307q-41 32-91 49.5T400-240q-134 0-227-93T80-560q0-134 93-227t227-93q134 0 227 93t93 227q0 56-17.5 106T653-363l227 227-56 56Z"/>
            </svg>
            Business Analysis
          </a>

          <a href="{{ url_for('cyber_data')}}" class="list-group-item list-group-item-action">
            <svg xmlns="http://www.w3.org/2000/svg" width="30px" height="30px" fill="currentColor" class="bi bi-lock-fill" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M8 0a4 4 0 0 1 4 4v2.05a2.5 2.5 0 0 1 2 2.45v5a2.5 2.5 0 0 1-2.5 2.5h-7A2.5 2.5 0 0 1 2 13.5v-5a2.5 2.5 0 0 1 2-2.45V4a4 4 0 0 1 4-4m0 1a3 3 0 0 0-3 3v2h6V4a3 3 0 0 0-3-3"/>
            </svg>
            Cyber Security
          </a>

          <a href="{{url_for('data_eng')}}" class="list-group-item list-group-item-action">
            <span class="material-symbols-outlined" height="30px" width="30px">
              auto_transmission
              </span>
            Data Engineering
          </a>

          <a href="{{ url_for('data_scie')}}" class="list-group-item list-group-item-action">
            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px" fill="currentColor">
              <path d="M206-206q-41-48-63.5-107.5T120-440q0-150 105-255t255-105h8l-64-64 56-56 160 160-160 160-57-57 63-63h-6q-116 0-198 82t-82 198q0 51 16.5 96t46.5 81l-57 57Zm234-14q0-23-15.5-45.5t-34.5-47q-19-24.5-34.5-51T340-420q0-58 41-99t99-41q58 0 99 41t41 99q0 30-15.5 56.5t-34.5 51q-19 24.5-34.5 47T520-220h-80Zm0 100v-60h80v60h-80Zm314-86-57-57q30-36 46.5-81t16.5-96q0-66-27.5-122.5T657-657l57-57q58 50 92 120.5T840-440q0 67-22.5 126.5T754-206Z"/>
            </svg>
            Data Science
          </a>

          <a href="{{url_for('rp_data')}}" class="list-group-item list-group-item-action">
            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px" fill="currentColor">
              <path d="M200-120q-33 0-56.5-23.5T120-200v-400q0-100 70-170t170-70h240q100 0 170 70t70 170v400q0 33-23.5 56.5T760-120H200Zm0-80h560v-400q0-66-47-113t-113-47H360q-66 0-113 47t-47 113v400Zm160-280q-33 0-56.5-23.5T280-560q0-33 23.5-56.5T360-640q33 0 56.5 23.5T440-560q0 33-23.5 56.5T360-480Zm240 0q-33 0-56.5-23.5T520-560q0-33 23.5-56.5T600-640q33 0 56.5 23.5T680-560q0 33-23.5 56.5T600-480ZM280-200v-80q0-33 23.5-56.5T360-360h240q33 0 56.5 23.5T680-280v80h-80v-80h-80v80h-80v-80h-80v80h-80Zm-80 0h560-560Z"/>
            </svg>
            RPA
          </a>
          <a href="{{ url_for('sys_eng')}}" class="list-group-item list-group-item-action">
            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px" fill="currentColor">
              <path d="M320-240 80-480l240-240 57 57-184 184 183 183-56 56Zm320 0-57-57 184-184-183-183 56-56 240 240-240 240Z"/>
            </svg>
            Software Engineering
          </a>

          <a href="{{ url_for('sys_data')}}" class="list-group-item list-group-item-action">
            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px" fill="currentColor">
              <path d="M240-360h96q19 0 32.5-13.5T382-406v-148q0-19-13.5-32.5T336-600h-96v240Zm46-46v-148h50v148h-50Zm149 46h98v-46h-82v-52h52v-46h-52v-50h82v-46h-98q-13 0-21.5 8.5T405-570v180q0 13 8.5 21.5T435-360Zm206-1q13 0 22.5-8.5T676-391l56-209h-48l-43 164-43-164h-48l56 209q3 13 12.5 21.5T641-361ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm0-560v560-560Z"/>
            </svg>
            System Development
          </a>

          <a href="{{ url_for('sys_sup')}}" class="list-group-item list-group-item-action">
            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px" fill="currentColor">
              <path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80ZM364-182l48-110q-42-15-72.5-46.5T292-412l-110 46q23 64 71 112t111 72Zm-72-366q17-42 47.5-73.5T412-668l-46-110q-64 24-112 72t-72 112l110 46Zm188 188q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35Zm116 178q63-24 110.5-71.5T778-364l-110-48q-15 42-46 72.5T550-292l46 110Zm72-368 110-46q-24-63-71.5-110.5T596-778l-46 112q41 15 71 45.5t47 70.5Z"/>
            </svg>
            System Support
          </a>

          <a href="#" class="list-group-item list-group-item-action" >
            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px" fill="currentColor">
              <path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h280v80H200Zm440-160-55-58 102-102H360v-80h327L585-622l55-58 200 200-200 200Z"/>
            </svg>
            Logout
          </a>
        </div>
      </div>
  </div>


    <div class="content">
        <div class="container ">
          <h1>DATA SCIENCE</h1>

          <div class="status-grid" class="fixed-top">

        

            <div class="status-item item1" >
                <strong >
                  <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-arrow-up-square" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm8.5 9.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707z"/>
                  </svg>
                  UPLOADED: <span id="uploadedCount">0</strong></span>
            </div>

            <div class="status-item item2">
              <strong class="">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-dash-circle" viewBox="0 0 16 16">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                  <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/>
                </svg>
                NOT UPLOADED:<span id="notUploadedCount">0</strong></span>
            </div>

            <div class="status-item item3">
              <strong>TOTAL:<span id="totalCount">0</strong></span>
            </div>

          </div>
          
          <div class="home-search">
              
          </div>

          <div class="upload-filter">

                  
      <form method="POST" action="{{ url_for('upload_bulk') }}">
            <div class="bulk">
              <p class="selected-learners">SELECTED LEARNERS: <span id="selectedCount">0</span></p>
              <div class="mb-2">
                <button type="submit" class="upload">Bulk upload</button>
              </div>
            </div>
          <div class="table-responsive">
            <table class="table table-bordered table-hover">
              <thead class="table-light">
                <tr>
                  <th><input type="checkbox" id="selectAll"></th>
                  <th>ID</th>
                  <th>Compliance Review</th>
                  <th>Simplepay Status</th>
                  <th>First Name</th>
                  <th>Last Name</th>
                  <th>ID/Passport</th>
                  <th>Date of Birth</th>
                  <th>Tax Ref</th>
                  <th>Start Date</th>
                  <th>Course</th>
                  <th>Sponsor</th>
                  <th>Bank</th>
                
                  <th>Branch code</th>
                  <th>Holder relationship</th>
                  <th>Accout Number</th>
                  <th>Type</th>
                  <th>Branch</th>
                  <th>Bank Confirmation</th>
                  <th>OCR status</th>
                  <th>Upload</th>
                  <th>Update</th>
                  <th>Street Name</th>
                  <th>Street Number</th>
                  <th>Unit Number</th>
                  <th>Complex/Building</th>
                  <th>Suburb/District</th>
                  <th>City/Town</th>
                  <th>Code</th>
                  <th>Province</th>
                  <th>Country</th>
                </tr>
              </thead>
              <tbody class="learnerTable">
                {% for learner in learners %}
                <tr data-status="{% if learner.simplepay_id and learner.simplepay_id != 'NULL' %}uploaded{% else %}not_uploaded{% endif %}">
                  
                  <td>
                    {% if not learner.simplepay_id or learner.simplepay_id == "NULL" %}
                      <input type="checkbox" name="selected_ids" value="{{ learner.id }}">
                    {% endif %}
                </td>
                
                
          <!-- ID -->
          <td>{{ learner.id }}</td>
      
          <!-- Investigation Column -->
          <td class="investigation-cell">
            <span class="badge bg-success status-badge">âœ” Clear</span>
            <button type="button" class="btn btn-sm btn-outline-danger toggle-flag">Flag</button>
          </td>
      
                  <td>
                    {% if learner.simplepay_id and learner.simplepay_id != "NULL" %}
                      <span class="status-yes">Uploaded ({{ learner.simplepay_id }})</span>
                    {% else %}
                      <span class="status-no"> Not Uploaded</span>
                    {% endif %}
                  </td>
                  <td>{{ learner.firstname }}</td>
                  <td>{{ learner.lastname }}</td>
                  <td>{{ learner.idnumber if learner.ID_no != 'NULL' else learner.Passport_number }}</td>
                  <td>{{ learner.birthdate }}</td>
                  <td>{{ learner.Tax_number }}</td>
                  <td>{{ learner.startdate }}</td>
                  <td>{{ learner.Course }}</td>
                  <td>{{ learner.Sponsor }}</td>
                  <td>{{ learner.bank }}</td>
                  
                  <td>{{ learner.Branch_Code }}</td>
                  <td>{{ learner.holder_relationship }}</td>
                  <td>{{ learner.account_no }}</td>
                  <td>{{ learner.account_type }}</td>
                  <td>{{ learner.Branch_Code }}</td>
                  <td>
                    {% if learner.bank_confirmation_url %}
                        <a href="{{ learner.bank_confirmation_url }}" target="_blank">
                            View {{ learner.bank_confirmation_filename }}
                        </a>
                    {% else %}
                        Not uploaded
                    {% endif %}
                  </td>
                  
                
                
                  <td class="ocr-cell">
                    {{ learner.ocr_status
                        | replace('Verified', '<span class="verified">Verified</span>')
                        | replace('Mismatch', '<span class="mismatch">Mismatch</span>')
                        | replace('Pending', '<span class="pending">Pending</span>')
                        | safe }}
                  </td>
                  
                  
                  


              <td>
                {% if not learner.simplepay_id or learner.simplepay_id == "NULL" %}
                <form method="POST" action="{{ url_for('upload_single', id=learner.id) }}">
                    <button type="submit" class="btn btn-success btn-sm">Upload</button>
                  </form>
                {% else %}
                  <button class="btn btn-secondary btn-sm" disabled>Uploaded</button>
                {% endif %}
              </td>

              <td>
                <a  href="{{ url_for('update_learner',id=learner.id) }}" >
                  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#59585B" class="bi bi-pencil-square svg-update" style="text-align: center;" viewBox="0 0 16 16">
                    <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                    <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
                  </svg>
                </a>
              </td>
              <td>{{ learner.Street_Name }}</td>
                  <td>{{ learner.Street_Number }}</td>
                  <td>{{ learner.Unit_Number }}</td>
                  <td>{{ learner.Complex_Building }}</td>
                  <td>{{ learner.Suburb_District }}</td>
                  <td>{{ learner.City_Town }}</td>
                  <td>{{ learner.Postal_Code }}</td>
                  <td>{{ learner.Province }}</td>
                  <td>{{ learner.Country }}</td>
                </tr>

                  
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>    
      </form>
    </div>
  </div>


<script>
  // ðŸ” Search Filter
  document.getElementById("searchInput").addEventListener("keyup", function () {
    let filter = this.value.toLowerCase();
    document.querySelectorAll(".learnerTable tr").forEach(row => {
      row.style.display = row.innerText.toLowerCase().includes(filter) ? "" : "none";
    });
  });
// Select/Deselect All
document.getElementById("selectAll").addEventListener("change", function () {
  document.querySelectorAll("input[name='selected_ids']").forEach(cb => cb.checked = this.checked);
});

// Uploaded/Not Uploaded Filter + Counters
document.getElementById("statusFilter").addEventListener("change", function () {
  let filter = this.value;
  let rows = document.querySelectorAll(".learnerTable tr");
  let uploadedCount = 0;
  let notUploadedCount = 0;
  let totalCount = 0;

  rows.forEach(row => {
    let status = row.getAttribute("data-status");
    if (status) totalCount++;

    if (status === "uploaded") uploadedCount++;
    if (status === "not_uploaded") notUploadedCount++;

    // Filtering logic
    if (filter === "all" || status === filter) {
      row.style.display = "";
    } else {
      row.style.display = "none";
    }
  });

  // Update counts display
  document.getElementById("uploadedCount").textContent = uploadedCount;
  document.getElementById("notUploadedCount").textContent = notUploadedCount;
  document.getElementById("totalCount").textContent = totalCount;
});

// Run once at page load to initialize counts
document.getElementById("statusFilter").dispatchEvent(new Event("change"));



//counts number of ticked boxes
const selectAll = document.getElementById("selectAll");
  const checkboxes = document.querySelectorAll('input[name="selected_ids"]');
  const selectedCount = document.getElementById("selectedCount");

  function updateCount() {
    const count = document.querySelectorAll('input[name="selected_ids"]:checked').length;
    selectedCount.textContent = count;
  }

  // When "Select All" is clicked
  selectAll.addEventListener("change", function () {
    checkboxes.forEach(cb => cb.checked = this.checked);
    updateCount();
  });

  // When any single checkbox is clicked
  checkboxes.forEach(cb => {
    cb.addEventListener("change", () => {
      if (!cb.checked) selectAll.checked = false; // uncheck "Select All" if any is unchecked
      updateCount();
    });
  });



// When any single checkbox is clicked
  checkboxes.forEach(cb => {
    cb.addEventListener("change", () => {
      if (!cb.checked) selectAll.checked = false; // uncheck "Select All" if any is unchecked
      updateCount();
    });
  });

  const sidebar = document.getElementById("sidebar");
  const content = document.querySelector(".content");
  const toggleBtn = document.getElementById("sidebarToggle");

  toggleBtn.addEventListener("click", () => {
    sidebar.classList.toggle("visible");
    content.classList.toggle("shifted");
  });

  document.querySelectorAll('.toggle-flag').forEach(button => {
  button.addEventListener('click', function() {
    const cell = this.closest('.investigation-cell');
    const badge = cell.querySelector('.status-badge');
    const row = this.closest('tr');
    const learnerId = row.querySelector('td:nth-child(2)').textContent.trim();
    const checkbox = row.querySelector('input[name="selected_ids"]');

    let isFlagged = this.textContent === 'Flag';

    if (isFlagged) {
      // Flagged
      badge.textContent = 'âš  Under Investigation';
      badge.classList.remove('bg-success');
      badge.classList.add('bg-danger');
      this.textContent = 'Unflag';
      this.classList.remove('btn-outline-danger');
      this.classList.add('btn-outline-success');
      localStorage.setItem(`learner_${learnerId}_flag`, 'true');

      // Hide checkbox when flagged
      if (checkbox) checkbox.style.display = 'none';
    } else {
      // Unflagged
      badge.textContent = 'âœ” Clear';
      badge.classList.remove('bg-danger');
      badge.classList.add('bg-success');
      this.textContent = 'Flag';
      this.classList.remove('btn-outline-success');
      this.classList.add('btn-outline-danger');
      localStorage.setItem(`learner_${learnerId}_flag`, 'false');

      // Show checkbox when unflagged
      if (checkbox) checkbox.style.display = '';
    }
  });
});

// Restore flag states & checkbox visibility after page reload
window.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.learnerTable tr').forEach(row => {
    const learnerId = row.querySelector('td:nth-child(2)').textContent.trim();
    const isFlagged = localStorage.getItem(`learner_${learnerId}_flag`);
    const cell = row.querySelector('.investigation-cell');
    const badge = cell.querySelector('.status-badge');
    const button = cell.querySelector('.toggle-flag');
    const checkbox = row.querySelector('input[name="selected_ids"]');

    if (isFlagged === 'true') {
      badge.textContent = 'âš  Under Investigation';
      badge.classList.remove('bg-success');
      badge.classList.add('bg-danger');
      button.textContent = 'Unflag';
      button.classList.remove('btn-outline-danger');
      button.classList.add('btn-outline-success');
      if (checkbox) checkbox.style.display = 'none';
    } else {
      badge.textContent = 'âœ” Clear';
      badge.classList.remove('bg-danger');
      badge.classList.add('bg-success');
      button.textContent = 'Flag';
      button.classList.remove('btn-outline-success');
      button.classList.add('btn-outline-danger');
      if (checkbox) checkbox.style.display = '';
    }
  });
});



  
</script>
</body>
</html>
